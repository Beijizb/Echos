# 开发者模式日志功能更新说明

## 🎉 更新内容

我已经大幅增强了开发者模式的日志功能，现在可以更方便地调试内置API搜索问题。

## ✨ 新功能

### 1. **日志级别分类**
日志现在分为5个级别：
- 🔍 **调试 (DEBUG)**: 详细的调试信息
- ℹ️ **信息 (INFO)**: 一般信息
- ⚠️ **警告 (WARNING)**: 警告信息
- ❌ **错误 (ERROR)**: 错误信息
- 🌐 **API**: API请求和响应

### 2. **日志过滤**
- 可以按日志级别筛选
- 每个级别显示对应的日志数量
- 支持多选过滤

### 3. **日志搜索**
- 实时搜索日志内容
- 支持搜索消息和数据字段
- 清除按钮快速重置搜索

### 4. **增强的日志显示**
- 彩色标记不同级别的日志
- 显示时间戳
- 显示关联数据（如果有）
- 可选择和复制日志内容

### 5. **API日志集成**
- 所有API请求自动记录到开发者日志
- 包含请求URL、方法、状态码、响应时间
- 错误会自动标记为错误级别

### 6. **日志控制选项**
在开发者模式的"设置"标签页新增：
- **API 日志**: 开关API请求日志记录
- **详细日志**: 开关详细调试信息（会产生大量日志）

## 📋 使用方法

### 启用开发者模式

1. **进入开发者模式**：
   - 打开应用设置
   - 连续点击"设置"标题或版本号 5 次
   - 看到"开发者模式已启用"提示

2. **打开开发者页面**：
   - 设置页面会出现"开发者模式"选项
   - 点击进入开发者页面

### 查看日志

1. **日志标签页**：
   - 开发者页面默认显示"日志"标签
   - 实时显示所有日志信息

2. **过滤日志**：
   - 点击顶部的级别芯片（如"🌐 API (5)"）
   - 可以同时选择多个级别
   - 取消选择会隐藏该级别的日志

3. **搜索日志**：
   - 在搜索框输入关键词
   - 实时过滤匹配的日志
   - 点击清除按钮重置搜索

4. **复制日志**：
   - 点击"复制全部"按钮
   - 复制当前过滤后的所有日志
   - 可以粘贴到文本编辑器查看

### 配置日志选项

在"设置"标签页：

1. **API 日志**（默认开启）：
   - 记录所有API请求和响应
   - 包含URL、状态码、响应时间
   - 关闭后不记录API日志

2. **详细日志**（默认关闭）：
   - 记录详细的调试信息
   - 会产生大量日志
   - 仅在需要深度调试时开启

## 🔍 调试搜索问题

### 步骤1：启用日志

1. 进入开发者模式
2. 打开开发者页面 → 设置标签
3. 确保"API 日志"已开启
4. 如需更详细信息，开启"详细日志"

### 步骤2：执行搜索

1. 返回主页面
2. 确认音源设置为"内置 API"
3. 在搜索框输入关键词（如"周杰伦"）
4. 点击搜索

### 步骤3：查看日志

1. 返回开发者页面 → 日志标签
2. 点击"🌐 API"筛选，只显示API日志
3. 查看API请求和响应信息

### 步骤4：分析问题

查找以下信息：

**成功的API请求**：
```
[12:34:56] 🌐 API: [netease] 📤 POST https://music.163.com/weapi/search/get
[12:34:57] 🌐 API: [netease] ✅ 200 (1234ms)
```

**失败的API请求**：
```
[12:34:56] 🌐 API: [netease] 📤 POST https://music.163.com/weapi/search/get
[12:34:57] ❌ ERROR: [netease] search 失败: Exception: ...
```

### 步骤5：导出日志

1. 点击"复制全部"按钮
2. 粘贴到文本文件保存
3. 可以分享给开发者分析

## 📊 日志示例

### API请求日志
```
[14:23:45] 🌐 API: [netease] 📤 POST https://music.163.com/weapi/search/get
  数据: {platform: netease, method: POST, url: https://music.163.com/weapi/search/get, timestamp: 2026-02-09T14:23:45.123}
```

### API响应日志
```
[14:23:46] 🌐 API: [netease] ✅ 200 (1234ms)
  数据: {platform: netease, url: https://music.163.com/weapi/search/get, statusCode: 200, duration_ms: 1234, body_length: 5678}
```

### 错误日志
```
[14:23:46] ❌ ERROR: [netease] search 失败: Exception: 搜索失败: 403
  数据: {platform: netease, operation: search, error: Exception: 搜索失败: 403, url: https://music.163.com/weapi/search/get}
```

### 信息日志
```
[14:23:44] ℹ️ INFO: 🔍 [SearchService] 使用内置API搜索: 周杰伦
[14:23:44] ℹ️ INFO: 🔍 [SearchService] 支持的平台: [netease, qq, kugou, kuwo]
```

## 💡 使用技巧

### 1. 快速定位错误
- 点击"❌ 错误"筛选
- 只显示错误日志
- 快速找到问题所在

### 2. 监控API性能
- 点击"🌐 API"筛选
- 查看响应时间
- 找出慢速API

### 3. 搜索特定平台
- 在搜索框输入平台名（如"netease"）
- 只显示该平台的日志
- 方便单独调试

### 4. 导出完整日志
- 不使用任何过滤
- 点击"复制全部"
- 获取完整的日志记录

### 5. 清理日志
- 日志过多时点击"清除日志"
- 重新开始记录
- 避免日志混乱

## 🎯 常见问题

### Q: 日志太多，看不过来？
**A**: 使用过滤和搜索功能：
1. 只选择需要的日志级别
2. 使用搜索框过滤关键词
3. 定期清除旧日志

### Q: 看不到API日志？
**A**: 检查以下设置：
1. 开发者模式 → 设置 → "API 日志"是否开启
2. 确认已执行搜索操作
3. 确认音源设置为"内置 API"

### Q: 日志显示不完整？
**A**:
1. 日志最多保存2000条
2. 超过后会自动删除最旧的日志
3. 及时导出重要日志

### Q: 如何分享日志给开发者？
**A**:
1. 使用过滤器选择相关日志
2. 点击"复制全部"
3. 粘贴到文本文件
4. 通过GitHub Issue或其他方式分享

## 🔧 技术细节

### 日志存储
- 内存存储，应用重启后清空
- 最多保存2000条日志
- 自动删除最旧的日志

### 性能影响
- API日志：几乎无影响
- 详细日志：会产生大量日志，可能影响性能
- 建议仅在调试时开启详细日志

### 日志格式
```
[时间] 级别图标 级别名称: 消息内容
  数据: {键值对}
```

## 📝 更新日志

### v1.1.0 (2026-02-09)
- ✅ 新增日志级别分类
- ✅ 新增日志过滤功能
- ✅ 新增日志搜索功能
- ✅ 新增彩色日志显示
- ✅ 新增API日志集成
- ✅ 新增日志控制选项
- ✅ 优化日志显示性能
- ✅ 增加日志数量限制

## 🚀 下一步

现在你可以：

1. **重新编译应用**：
   ```bash
   cd D:\test\os
   flutter clean
   flutter pub get
   flutter run -d windows
   ```

2. **启用开发者模式**：
   - 连续点击设置标题5次

3. **测试搜索功能**：
   - 搜索"周杰伦"
   - 查看开发者日志

4. **分析问题**：
   - 使用过滤和搜索功能
   - 找到错误信息
   - 复制日志分享

祝调试顺利！🎉
